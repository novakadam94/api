#!/usr/bin/env python

# Copyright (C) 2015 MTA SZTAKI

"""
This script stops a single node using OCCO-CloudHandler and
OCCO-InfraProcessor.

Author: adam.visegradi@sztaki.mta.hu
"""

import occo.api.occoapp as occoapp
import yaml

def setup_args(cfg):
    cfg.add_argument('instance_data', type=occoapp.yaml_file)

occoapp.setup(setup_args)

import logging
log = logging.getLogger('occo')

instance_data = occoapp.args.instance_data

log.debug('Configuration:\n%r', occoapp.configuration)
log.info('Instance data:\n%r', instance_data)

from occo.infraprocessor import InfraProcessor
ip = InfraProcessor(protocol='basic',
                    user_data_store=occoapp.uds,
                    cloudhandler=occoapp.cloudhandler,
                    servicecomposer=occoapp.servicecomposer)
drop_node_command = ip.cri_drop_node(instance_data)
log.debug('DropNode:\n%s',
          yaml.dump(drop_node_command, default_flow_style=False))

ip.push_instructions(drop_node_command)
