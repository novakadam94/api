#!/usr/bin/env python

# Copyright (C) 2015 MTA SZTAKI

"""
This script starts a single node using OCCO-CloudHandler and
OCCO-InfraProcessor.

Author: adam.visegradi@sztaki.mta.hu
"""

import occo.api.occoapp as occoapp
import yaml

def setup_args(cfg):
    cfg.add_argument('node_def', type=occoapp.yaml_file)

occoapp.setup(setup_args)

import logging
log = logging.getLogger('occo')

#
## Load node definition
#
node_definition = occoapp.args.node_def

log.debug('Configuration:\n%r', occoapp.configuration)
log.debug('Node definition:\n%r', node_definition)

ip = occoapp.infrastructure['infraprocessor']
create_node_command = ip.cri_create_node(node_definition)
log.info('CreateNode:\n%s', yaml.dump(create_node_command, default_flow_style=False))

retval = ip.push_instructions(create_node_command)
log.info('%r', retval)
# Final result: instance_data
print yaml.dump(retval[0], default_flow_style=False)
