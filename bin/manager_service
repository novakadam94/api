#!/usr/bin/env python

# Copyright (C) 2015 MTA SZTAKI

"""
This script starts an infrastructure using OCCO.

Author: adam.visegradi@sztaki.mta.hu
"""

import occo.api.occoapp as occoapp
import occo.api.manager as manager
import flask

def setup_args(cfg):
    pass # TODO: reconnect to already submitted infrstructures

if __name__ == '__main__':

    occoapp.setup(setup_args)

    import logging
    log = logging.getLogger('occo.manager-service')

    infra_processor_params = dict(
        protocol='basic',
        user_data_store=occoapp.uds,
        cloudhandler=occoapp.cloudhandler,
        servicecomposer=occoapp.servicecomposer)

    manager = manager.InfrastructureManager(occoapp.uds, infra_processor_params)

    try:
        # TODO: Expose the manager through Flask
        # TODO: Expose InfoBroker

    except KeyboardInterrupt:
        log.info('Ctrl+C - Destroying infrastructure and exiting.')
        occoapp.killall(infraid, ip)
